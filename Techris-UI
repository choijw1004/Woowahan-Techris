Morph subclass: #TetrisApp	instanceVariableNames: 'currentScreen'	classVariableNames: ''	package: 'Techris-UI'!TetrisApp class	instanceVariableNames: ''!Morph subclass: #TetrisMorph	instanceVariableNames: 'game cellSize app'	classVariableNames: ''	package: 'Techris-UI'!TetrisMorph class	instanceVariableNames: ''!Morph subclass: #TetrisMenuMorph	instanceVariableNames: 'app'	classVariableNames: ''	package: 'Techris-UI'!TetrisMenuMorph class	instanceVariableNames: ''!!TetrisApp class methodsFor: 'instance creation' stamp: '2025-11-24T20:16:06.81772+09:00' prior: 0!open    | app window |    app := self new.    window := app openInWindow.    window extent: 750@730.     window center: World center.      ^ app! !!TetrisApp class methodsFor: 'system startup' stamp: '2025-11-24T20:16:06.818809+09:00' prior: 0!startUp: resuming    resuming ifTrue: [        self open.    ]! !!TetrisApp methodsFor: 'initialization' stamp: '2025-11-24T20:16:06.820776+09:00' prior: 0!initialize    super initialize.    self extent: 750@715.    self color: Color transparent.    self showMenu! !!TetrisApp methodsFor: 'accessing' stamp: '2025-11-24T20:16:06.821246+09:00' prior: 0!showMenu    currentScreen ifNotNil: [         currentScreen delete.        currentScreen := nil.    ].    currentScreen := TetrisMenuMorph new.    currentScreen app: self.    currentScreen bounds: self bounds.    self addMorph: currentScreen! !!TetrisApp methodsFor: 'as yet unclassified' stamp: '2025-11-24T20:16:06.821428+09:00' prior: 0!startGame    currentScreen ifNotNil: [         currentScreen delete.        currentScreen := nil.    ].    currentScreen := TetrisMorph new.    currentScreen app: self.    currentScreen bounds: self bounds.    self addMorph: currentScreen.    currentScreen takeKeyboardFocus! !!TetrisMenuMorph methodsFor: 'accessing' stamp: '2025-11-24T20:16:06.821524+09:00' prior: 0!app: aTetrisApp    app := aTetrisApp! !!TetrisMenuMorph methodsFor: 'as yet unclassified' stamp: '2025-11-24T20:16:06.821738+09:00' prior: 0!createButton: text action: aBlock    | container blocks letters x blockSize |        container := Morph new.    container extent: 500@100.      container color: Color transparent.        letters := 'START' asArray.     blocks := OrderedCollection new.    x := 0.    blockSize := 100.         letters do: [:char |        | block label |                block := Morph new.        block extent: blockSize@blockSize.          block color: Color white.        block borderWidth: 2.        block borderColor: Color black.        block position: container position + (x@0).                label := StringMorph new            contents: char asString;            font: (LogicalFont familyName: 'Source Sans Pro' pointSize: 50);              color: Color black.        block addMorph: label.        label position: block center - (label extent // 2).                block on: #mouseDown send: #value to: aBlock.                container addMorph: block.        blocks add: block.        x := x + blockSize.    ].        container on: #mouseEnter send: #value to: [         blocks do: [:b | b color: Color yellow]     ].    container on: #mouseLeave send: #value to: [         blocks do: [:b | b color: Color white]     ].        ^ container! !!TetrisMenuMorph methodsFor: 'as yet unclassified' stamp: '2025-11-24T20:16:06.822012+09:00' prior: 0!createUI    | title subtitle instruction keyInfo warning startBtn yPos |        yPos := 100.        title := StringMorph new        contents: 'Woowa-Techris';          font: (LogicalFont familyName: 'Source Sans Pro' pointSize: 72);        color: Color black;        yourself.    self addMorph: title.    title position: (self width // 2) - (title width // 2) @ yPos.        yPos := yPos + 130.    subtitle := StringMorph new        contents: 'with Pharo & Smalltalk';        font: (LogicalFont familyName: 'Source Sans Pro' pointSize: 24);        color: Color black;        yourself.    self addMorph: subtitle.    subtitle position: (self width // 2) - (subtitle width // 2) @ yPos.        yPos := yPos + 80.    instruction := StringMorph new        contents: 'Controls';         font: (LogicalFont familyName: 'Source Sans Pro' pointSize: 22);        color: Color black;        yourself.    self addMorph: instruction.    instruction position: (self width // 2) - (instruction width // 2) @ yPos.        yPos := yPos + 45.    keyInfo := StringMorph new        contents: 'W - Rotate | A - Left | S - Down | D - Right';          font: (LogicalFont familyName: 'Source Sans Pro' pointSize: 18);        color: Color black;        yourself.    self addMorph: keyInfo.    keyInfo position: (self width // 2) - (keyInfo width // 2) @ yPos.        yPos := yPos + 35.    keyInfo := StringMorph new        contents: 'Space - Hard Drop | X - Pause';          font: (LogicalFont familyName: 'Source Sans Pro' pointSize: 18);        color: Color black;        yourself.    self addMorph: keyInfo.    keyInfo position: (self width // 2) - (keyInfo width // 2) @ yPos.    yPos := yPos + 50.    warning := StringMorph new        contents: '* Please switch to English input mode before clicking Start';          font: (LogicalFont familyName: 'Source Sans Pro' pointSize: 16);        color: (Color r: 0.8 g: 0 b: 0);        yourself.    self addMorph: warning.    warning position: (self width // 2) - (warning width // 2) @ yPos.        yPos := yPos + 100.    startBtn := self createButton: 'START GAME'        action: [ app ifNotNil: [ app startGame ] ].    self addMorph: startBtn.    startBtn position: (self width // 2) - (startBtn width // 2) @ yPos! !!TetrisMenuMorph methodsFor: 'initialization' stamp: '2025-11-24T20:16:06.822176+09:00' prior: 0!initialize    super initialize.    self extent: 750@715.    self color: (Color fromHexString: '0cefd3').    self createUI! !!TetrisMorph methodsFor: 'testing' stamp: '2025-11-24T20:16:06.822509+09:00' prior: 0!acceptsKeyboardFocus    ^ true! !!TetrisMorph methodsFor: 'accessing' stamp: '2025-11-24T20:16:06.822557+09:00' prior: 0!app: aTetrisApp    app := aTetrisApp! !!TetrisMorph methodsFor: 'defaults' stamp: '2025-11-24T20:16:06.822789+09:00' prior: 0!colorForBlockType: blockType    blockType = 0 ifTrue: [ ^ Color white ].    blockType = #I ifTrue: [ ^ Color cyan ].    blockType = #O ifTrue: [ ^ Color yellow ].    blockType = #T ifTrue: [ ^ Color magenta ].    blockType = #S ifTrue: [ ^ Color green ].    blockType = #Z ifTrue: [ ^ Color red ].    blockType = #J ifTrue: [ ^ Color blue ].    blockType = #L ifTrue: [ ^ Color orange ].    ^ Color gray! !!TetrisMorph methodsFor: 'as yet unclassified' stamp: '2025-11-24T20:16:06.822917+09:00' prior: 0!createGameOverButton: text at: position    | container blocks letters x |        container := Morph new.    container extent: 200@60.    container color: Color transparent.    container position: position.        letters := text asArray.    blocks := OrderedCollection new.    x := 0.        letters do: [:char |        | block label blockWidth |        blockWidth := 200 // letters size.                block := Morph new.        block extent: blockWidth@60.        block color: Color white.        block borderWidth: 2.        block borderColor: Color black.        block position: container position + (x@0).                label := StringMorph new            contents: char asString;            font: (LogicalFont familyName: 'Source Sans Pro' pointSize: 32);            color: Color black.        block addMorph: label.        label position: block center - (label extent // 2).                container addMorph: block.        blocks add: block.        x := x + blockWidth.    ].        container on: #mouseEnter send: #value to: [         blocks do: [:b | b color: Color yellow]     ].    container on: #mouseLeave send: #value to: [         blocks do: [:b | b color: Color white]     ].        ^ container! !!TetrisMorph methodsFor: 'as yet unclassified' stamp: '2025-11-24T20:16:06.823239+09:00' prior: 0!createGameOverButtons    | yPos restartBtn menuBtn |        yPos := self bounds center y + 200.        restartBtn := self createGameOverButton: 'RETRY' at: (self bounds center x - 220) @ yPos.    self addMorph: restartBtn.    restartBtn on: #mouseDown send: #value to: [         self removeGameOverButtons.        self restart.    ].        menuBtn := self createGameOverButton: 'MENU' at: (self bounds center x + 20) @ yPos.    self addMorph: menuBtn.    menuBtn on: #mouseDown send: #value to: [         self removeGameOverButtons.        app ifNotNil: [ app showMenu ].    ]! !!TetrisMorph methodsFor: 'as yet unclassified' stamp: '2025-11-24T20:16:06.823413+09:00' prior: 0!drawCenteredKey: aCanvas text: aString at: x y: y width: aPanelWidth font: aFont    | textWidth |    textWidth := aFont widthOfString: aString.    aCanvas drawString: aString         at: (x + (aPanelWidth // 2) - (textWidth // 2)) @ y         font: aFont         color: Color white! !!TetrisMorph methodsFor: 'as yet unclassified' stamp: '2025-11-24T20:16:06.823521+09:00' prior: 0!drawCenteredKey: aCanvas text: aString at: x y: y width: aPanelWidth font: aFont color: aColor    | textWidth |    textWidth := aFont widthOfString: aString.    aCanvas drawString: aString         at: (x + (aPanelWidth // 2) - (textWidth // 2)) @ y         font: aFont         color: aColor! !!TetrisMorph methodsFor: 'as yet unclassified' stamp: '2025-11-24T20:16:06.823679+09:00' prior: 0!drawGameOver: canvas    | titleFont scoreFont subFont titleText scoreText subText titleWidth scoreWidth subWidth yPos |        canvas fillRectangle: self bounds color: (Color black alpha: 0.75).        titleFont := LogicalFont familyName: 'Source Sans Pro' pointSize: 250.    scoreFont := LogicalFont familyName: 'Source Sans Pro' pointSize: 48.    subFont := LogicalFont familyName: 'Source Sans Pro' pointSize: 24.        yPos := self bounds center y - 300.        titleText := 'FULL'.    titleWidth := titleFont widthOfString: titleText.    canvas drawString: titleText         at: (self bounds center x - (titleWidth // 2)) @ yPos         font: titleFont         color: Color white.        yPos := yPos + 350.    subText := 'No more space left!!'.    subWidth := subFont widthOfString: subText.    canvas drawString: subText         at: (self bounds center x - (subWidth // 2)) @ yPos         font: subFont         color: (Color white ).        yPos := yPos + 60.    scoreText := 'Final Score: ', game score printString.    scoreWidth := scoreFont widthOfString: scoreText.    canvas drawString: scoreText         at: (self bounds center x - (scoreWidth // 2)) @ yPos         font: scoreFont         color: Color yellow.        (self submorphs noneSatisfy: [:m | m isKindOf: Morph]) ifTrue: [        self createGameOverButtons    ]! !!TetrisMorph methodsFor: 'drawing' stamp: '2025-11-24T20:16:06.824088+09:00' prior: 0!drawGhost: canvas offsetX: offsetX offsetY: offsetY    | ghost ghostColor |        game currentTetromino ifNil: [ ^ self ].        ghost := game ghostTetromino.    ghost ifNil: [ ^ self ].        (ghost row = game currentTetromino row and: [         ghost col = game currentTetromino col ]) ifTrue: [ ^ self ].        ghostColor := (game currentTetromino color alpha: 0.3).        ghost cells do: [:pt |        | rect |        rect := (offsetX + ((pt x - 1) * cellSize))                    @ (offsetY + ((pt y - 1) * cellSize))                    extent: cellSize @ cellSize.                canvas fillRectangle: rect color: ghostColor.        canvas frameRectangle: rect width: 1 color: (ghostColor darker alpha: 0.5).    ]! !!TetrisMorph methodsFor: 'drawing' stamp: '2025-11-24T20:16:06.824301+09:00' prior: 0!drawInfoPanel: canvas at: position    | titleFont scoreFont y panelWidth scoreText titleText titleWidth scoreWidth |        game ifNil: [ ^ self ].        titleFont := LogicalFont familyName: 'Source Sans Pro' pointSize: 16.    scoreFont := LogicalFont familyName: 'Source Sans Pro' pointSize: 28.    panelWidth := 150.        y := self bounds top + 80.        titleText := 'SCORE'.    titleWidth := titleFont widthOfString: titleText.    canvas drawString: titleText         at: (position x + (panelWidth // 2) - (titleWidth // 2)) @ y         font: titleFont         color: Color black.        y := y + 50.    scoreText := game score printString.    scoreWidth := scoreFont widthOfString: scoreText.    canvas drawString: scoreText         at: (position x + (panelWidth // 2) - (scoreWidth // 2)) @ y         font: scoreFont        color: Color black.    y := y + 120.    self drawNextTetromino: canvas at: (position x + (panelWidth // 2) - (110 // 2)) @ y! !!TetrisMorph methodsFor: 'drawing' stamp: '2025-11-24T20:16:06.824482+09:00' prior: 0!drawKeysPanel: canvas at: position    | font titleFont y panelWidth titleText titleWidth |    font := LogicalFont familyName: 'Source Sans Pro' pointSize: 12.    titleFont := LogicalFont familyName: 'Source Sans Pro' pointSize: 16.    panelWidth := 150.       y := self bounds top + 80.        titleText := 'Controls'.    titleWidth := titleFont widthOfString: titleText.    canvas drawString: titleText         at: (position x + (panelWidth // 2) - (titleWidth // 2)) @ y         font: titleFont         color: Color black.        y := y + 50.        self drawCenteredKey: canvas text: 'W - Rotate' at: position x y: y width: panelWidth font: font color: Color black.    y := y + 30.     self drawCenteredKey: canvas text: 'A - Left       ' at: position x y: y width: panelWidth font: font color: Color black.    y := y + 30.        self drawCenteredKey: canvas text: 'S - Down   ' at: position x y: y width: panelWidth font: font color: Color black.    y := y + 30.     self drawCenteredKey: canvas text: 'D - Right    ' at: position x y: y width: panelWidth font: font color: Color black.    y := y + 30.        self drawCenteredKey: canvas text: 'Space bar' at: position x y: y width: panelWidth font: font color: Color black.    y := y + 30.    self drawCenteredKey: canvas text: 'Hard Drop' at: position x y: y width: panelWidth font: font color: Color black.        y := y + 70.        self drawCenteredKey: canvas text: 'X - Go to Menu    ' at: position x y: y width: panelWidth font: font color: Color black! !!TetrisMorph methodsFor: 'drawing' stamp: '2025-11-24T20:16:06.824655+09:00' prior: 0!drawNextTetromino: canvas at: position    | titleFont nextTetromino previewSize previewBox cells centerOffset titleText titleWidth |        titleFont := LogicalFont familyName: 'Source Sans Pro' pointSize: 22.        titleText := 'NEXT'.    titleWidth := titleFont widthOfString: titleText.    canvas drawString: titleText        at: (position x + 20) @ position y          font: titleFont         color: Color black.        game nextTetromino ifNotNil: [        nextTetromino := game nextTetromino.        previewSize := 16.               previewBox := (position + (0@70)) extent: 110@110.        canvas fillRectangle: previewBox color: Color white.        canvas frameRectangle: previewBox width: 2 color: Color black.                cells := nextTetromino type cellsForRotationIndex: 0.        centerOffset := previewBox center - (2 * previewSize @ (2 * previewSize)).                cells do: [:pt |            | rect color |            rect := (centerOffset + (pt x * previewSize @ (pt y * previewSize)))                        extent: previewSize @ previewSize.            color := nextTetromino color.            canvas fillRectangle: rect color: color.            canvas frameRectangle: rect width: 1 color: color darker.        ].    ]! !!TetrisMorph methodsFor: 'drawing' stamp: '2025-11-24T20:16:06.824899+09:00' prior: 0!drawOn: canvas    | w h boardWidth boardHeight sideWidth offsetX offsetY |    super drawOn: canvas.        game ifNil: [ ^ self ].        w := game board width.    h := game board height.    boardWidth := w * cellSize.    boardHeight := h * cellSize.    sideWidth := 160.        offsetX := self bounds left + sideWidth.    offsetY := self bounds top.       canvas fillRectangle: self bounds color: (Color fromHexString: '0cefd3').        canvas fillRectangle: (offsetX @ offsetY extent: boardWidth @ boardHeight)        color: Color white.        1 to: h do: [:row |        1 to: w do: [:col |            | value rect color |            value := game board atRow: row col: col.            rect := (offsetX + ((col - 1) * cellSize))                        @ (offsetY + ((row - 1) * cellSize))                        extent: cellSize @ cellSize.                        value = 0                 ifTrue: [                    canvas frameRectangle: rect width: 1 color: (Color gray alpha: 0.2).                ]                ifFalse: [                    color := self colorForBlockType: value.                    canvas fillRectangle: rect color: color.                    canvas frameRectangle: rect width: 1 color: (Color black alpha: 0.3).                ].        ].    ].        self drawGhost: canvas offsetX: offsetX offsetY: offsetY.        [        game currentTetromino ifNotNil: [            game currentTetromino cells do: [:pt |                | rect tetrominoColor |                rect := (offsetX + ((pt x - 1) * cellSize))                            @ (offsetY + ((pt y - 1) * cellSize))                            extent: cellSize @ cellSize.                                tetrominoColor := [game currentTetromino color]                     on: Error                     do: [:ex | Color green].                                canvas fillRectangle: rect color: tetrominoColor.                canvas frameRectangle: rect width: 1 color: (Color black alpha: 0.5).            ].        ].    ] on: Error do: [:ex |         Transcript show: 'drawOn error: ', ex messageText; cr.    ].        self drawKeysPanel: canvas at: self bounds left @ (self bounds top + 50).    self drawInfoPanel: canvas at: (self bounds left + sideWidth + boardWidth) @ (self bounds top + 50).        game gameOver ifTrue: [        self drawGameOver: canvas    ]! !!TetrisMorph methodsFor: 'event handling' stamp: '2025-11-24T20:16:06.825071+09:00' prior: 0!handleKeystroke: event    | key |    key := event keyValue.        Transcript show: 'handleKeystroke: ', key printString; cr.        key = 120 ifTrue: [         self stopStepping.        app ifNotNil: [ app showMenu ].        ^ true     ].    key = 97 ifTrue: [ game moveLeft. self changed. ^ true ].    key = 100 ifTrue: [ game moveRight. self changed. ^ true ].    key = 115 ifTrue: [ game stepDown. self changed. ^ true ].    key = 119 ifTrue: [ game rotate. self changed. ^ true ].    key = 32 ifTrue: [ game hardDrop. self changed. ^ true ].        ^ false! !!TetrisMorph methodsFor: 'defaults' stamp: '2025-11-24T20:16:06.825165+09:00' prior: 0!handlesKeyboard    ^ true! !!TetrisMorph methodsFor: 'defaults' stamp: '2025-11-24T20:16:06.825302+09:00' prior: 0!handlesMouseDown: evt    ^ true! !!TetrisMorph methodsFor: 'initialization' stamp: '2025-11-24T20:16:06.825357+09:00' prior: 0!initialize   	 | boardWidth boardHeight sideWidth totalWidth |	 super initialize.    game := TetrisGame newStandard.    cellSize :=35 .    boardWidth := game board width * cellSize.    boardHeight := game board height * cellSize.    sideWidth := 200.      totalWidth := sideWidth + boardWidth + sideWidth.        self extent: totalWidth @ boardHeight.    self color: (Color r: 0.05 g: 0.05 b: 0.15).     self borderWidth: 2.    self borderColor: Color black.    self startStepping! !!TetrisMorph methodsFor: 'defaults' stamp: '2025-11-24T20:16:06.825417+09:00' prior: 0!mouseDown: evt    self takeKeyboardFocus.	 evt hand grabMorph: self.    ^ true ! !!TetrisMorph methodsFor: 'removing' stamp: '2025-11-24T20:16:06.825685+09:00' prior: 0!removeGameOverButtons    self submorphs copy do: [:m |         (m isKindOf: Morph) ifTrue: [ m delete ]    ]! !!TetrisMorph methodsFor: 'start' stamp: '2025-11-24T20:16:06.825737+09:00' prior: 0!restart    self removeGameOverButtons.    game := TetrisGame newStandard.    self changed! !!TetrisMorph methodsFor: 'defaults' stamp: '2025-11-24T20:16:06.825794+09:00' prior: 0!step    game tick.    self changed.! !!TetrisMorph methodsFor: 'defaults' stamp: '2025-11-24T20:16:06.825848+09:00' prior: 0!stepTime    ^ 450! !!TetrisMorph methodsFor: 'defaults' stamp: '2025-11-24T20:16:06.825908+09:00' prior: 0!wantsKeyboardFocus    ^ true! !TetrisApp initialize!TetrisMorph initialize!TetrisMenuMorph initialize!